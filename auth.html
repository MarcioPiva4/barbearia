<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lipe Cortes | Entrar</title>
  <link rel="stylesheet" href="auth.css">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
  <div class="container">
    <a href="index.html" class="back-link">
      <i data-lucide="arrow-left" class="icon"></i>
      Voltar ao início
    </a>

    <div class="card">
      <div class="card-header">
        <div class="logo-circle">
          <i data-lucide="scissors" class="logo-icon"></i>
        </div>
        <h1 class="title">Lipe Cortes</h1>
        <p class="subtitle">Acesse sua conta ou crie uma nova</p>
      </div>

      <div class="tabs">
        <a href="auth.html" id="login-tab" class="tab active">Entrar</a>
        <a href="signup.html" id="signup-tab" class="tab"> Cadastrar</a>
      </div>

      <div id="login-content">
        <form id="login-form" class="form">
          <label>Email</label>
          <input type="email" id="login-email" placeholder="seu@email.com" required>

          <label>Senha</label>
          <input type="password" id="login-password" placeholder="••••••••" required minlength="6">

          <button type="submit" class="btn">Entrar</button>
          <p class="error hidden">Email ou senha incorretos.</p>
        </form>
      </div>

      <div id="signup-content" class="hidden">
        <form id="signup-form" class="form">
          <label>Nome completo</label>
          <input type="text" id="signup-name" placeholder="Seu nome completo" required minlength="2">

          <label>Email</label>
          <input type="email" id="signup-email" placeholder="seu@email.com" required>

          <label>Senha</label>
          <input type="password" id="signup-password" placeholder="••••••••" required minlength="6">

          <label>Confirmar senha</label>
          <input type="password" id="signup-confirm-password" placeholder="••••••••" required>

          <button type="submit" class="btn">Criar conta</button>
          <p class="error hidden">As senhas não coincidem.</p>
        </form>
      </div>
    </div>
  </div>

  <script>
const loginForm = document.getElementById("login-form");
const errorMessage = document.querySelector("#login-form .error");

loginForm.addEventListener("submit", async (event) => {
  event.preventDefault();

  const email = document.getElementById("login-email").value.trim();
  const password = document.getElementById("login-password").value;

  errorMessage.classList.add("hidden");
  errorMessage.textContent = "";

  try {
    const response = await fetch("https://lipes-cortes.vercel.app/api/auth/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password }),
    });

    const data = await response.json();

    if (!response.ok) {
      errorMessage.textContent = data.error || "Erro ao fazer login.";
      errorMessage.classList.remove("hidden");
      return;
    }

    const expires = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toUTCString();

    // Define os cookies
    document.cookie = `token=${data.token}; path=/; expires=${expires}; SameSite=Lax`;
    document.cookie = `role=${data.user.role}; path=/; expires=${expires}; SameSite=Lax`;

    // Redireciona de acordo com o role
    console.log(data)
    if (data.user.role === "ADMIN") {
      window.location.href = "admin-dashboard.html";
    } else {
      window.location.href = "dashboard.html";
    }
  } catch (err) {
    errorMessage.textContent = "Erro na conexão com o servidor.";
    errorMessage.classList.remove("hidden");
    console.error(err);
  }
});


  </script>
  <script>lucide.createIcons();</script>
</body>
</html>
